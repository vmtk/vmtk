PROJECT(VMTK_TESTING)

include(${VMTK_SOURCE_DIR}/CMake/ExternalData.cmake)
include(${VMTK_SOURCE_DIR}/CMake/VMTKExternalData.cmake)

set(VMTK_TESTING_INIT_SRC
  __init__.py
  )

IF(NOT VMTK_TESTING_INSTALL_LIB_DIR)
  SET(VMTK_TESTING_INSTALL_LIB_DIR ${CMAKE_BINARY_DIR}/tests)
ENDIF(NOT VMTK_TESTING_INSTALL_LIB_DIR)

FOREACH (SCRIPT_FILE ${VMTK_TESTING_INIT_SRC})
  CONFIGURE_FILE(${VMTK_TESTING_SOURCE_DIR}/${SCRIPT_FILE} ${VMTK_TESTING_INSTALL_LIB_DIR}/${SCRIPT_FILE} COPYONLY)
ENDFOREACH (SCRIPT_FILE)

ExternalData_Add_Test(AllData
  NAME AllTests
  COMMAND python -m pytest ${VMTK_TESTING_INSTALL_LIB_DIR}
  DATA{data/,RECURSE:,REGEX:.*}
  )
ExternalData_Add_Target(AllData)


set(VMTK_TESTING_DIRECTORIES
  test_PypeS
  test_vmtkScripts
  )

FOREACH (TEST_DIR ${VMTK_TESTING_DIRECTORIES})
  add_subdirectory(${TEST_DIR})
ENDFOREACH (TEST_DIR)