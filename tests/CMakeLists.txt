PROJECT(VMTK_TESTING)

include(${VMTK_SOURCE_DIR}/CMake/ExternalData.cmake)
include(${VMTK_SOURCE_DIR}/CMake/VMTKExternalData.cmake)


set(VMTK_TESTING_DIRECTORIES
  test_PypeS
  test_vmtkScripts
  )

FOREACH (TEST_DIR ${VMTK_TESTING_DIRECTORIES})
  add_subdirectory(${TEST_DIR})
ENDFOREACH (TEST_DIR)


set(VMTK_TESTING_INIT_SRC
  __init__.py
  )

IF(NOT VMTK_TESTING_INSTALL_LIB_DIR)
  SET(VMTK_TESTING_INSTALL_LIB_DIR tests)
ENDIF(NOT VMTK_TESTING_INSTALL_LIB_DIR)

INSTALL(FILES ${VMTK_TESTING_INIT_SRC}
  DESTINATION ${VMTK_TESTING_INSTALL_LIB_DIR}
  COMPONENT PythonRuntimeLibraries)

ExternalData_Add_Test(AllData
  NAME AllTests
  COMMAND python -m pytest ${VMTK_TESTING_INSTALL_LIB_DIR}
  DATA{data/,RECURSE:,REGEX:.*}
  )
ExternalData_Add_Target(AllData)